<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>FrequencyDoctor</title>
  <meta name="theme-color" content="#0ea5e9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FrequencyDoctor">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="img/favicon.png" sizes="any" type="image/png">
  <link rel="apple-touch-icon" href="img/favicon.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <h1 class="brand-name">FrequencyDoctor</h1>
    </div>
    <div class="header-actions">
      <button id="settingsBtn" class="icon-btn" aria-label="Settings" title="Settings">
        <svg class="svg-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M19.4 13.5c.05-.5.1-1 .1-1.5s-.05-1-.1-1.5l2-1.5a.7.7 0 0 0 .15-.9l-1.9-3.3a.7.7 0 0 0-.85-.3l-2.3 1a7.3 7.3 0 0 0-2.6-1.5l-.35-2.5A.7.7 0 0 0 12 1h-4a.7.7 0 0 0-.7.6l-.35 2.5a7.3 7.3 0 0 0-2.6 1.5l-2.3-1a.7.7 0 0 0-.85.3L.3 8.2a.7.7 0 0 0 .15.9l2 1.5c-.05.5-.1 1-.1 1.5s.05 1 .1 1.5l-2 1.5a.7.7 0 0 0-.15.9l1.9 3.3c.2.3.53.44.85.3l2.3-1c.75.62 1.63 1.15 2.6 1.5l.35 2.5c.05.34.35.6.7.6h4c.35 0 .65-.26.7-.6l.35-2.5c.97-.35 1.85-.88 2.6-1.5l2.3 1c.32.14.65 0 .85-.3l1.9-3.3a.7.7 0 0 0-.15-.9l-2-1.5ZM10 15a3 3 0 1 1 4 0 3 3 0 0 1-4 0Z"/></svg>
      </button>
      <button id="helpBtn" class="icon-btn text" aria-label="Help" title="Help">?</button>
    </div>
  </header>

  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" hidden>
    <div class="modal-overlay" data-close="1"></div>
    <div class="modal-panel">
      <div class="modal-head">
        <h2 id="settingsTitle">Settings</h2>
        <button id="settingsClose" class="icon-btn" aria-label="Close settings"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M6.2 6.2 18 18m0-11.8L6.2 18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg></button>
      </div>
      <div class="modal-body">
        <div class="setting-row">
          <div class="setting-label">Theme</div>
          <div class="setting-field">
            <label class="radio"><input type="radio" name="theme" id="themeDark" value="dark"> Dark</label>
            <label class="radio"><input type="radio" name="theme" id="themeLight" value="light"> Light</label>
          </div>
        </div>
        <div class="setting-row">
          <div class="setting-label">Audio</div>
          <div class="setting-field">
            <button id="resetAudio" class="btn">Reset audio engine</button>
          </div>
        </div>
        <div class="setting-row">
          <div class="setting-label">Fade in (s)</div>
          <div class="setting-field"><input id="fadeInInput" type="number" min="0.1" max="15" step="0.1" value="5" class="timer-input" aria-label="Fade in seconds"></div>
        </div>
        <div class="setting-row">
          <div class="setting-label">Fade out (s)</div>
          <div class="setting-field"><input id="fadeOutInput" type="number" min="0.1" max="15" step="0.1" value="3" class="timer-input" aria-label="Fade out seconds"></div>
        </div>
      </div>
      <div class="modal-foot">
        <button id="settingsSave" class="btn primary">Save</button>
        <button id="settingsCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" hidden>
    <div class="modal-overlay" data-close="1"></div>
    <div class="modal-panel">
      <div class="modal-head">
        <h2 id="helpTitle">Help</h2>
        <button id="helpClose" class="icon-btn" aria-label="Close help"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M6.2 6.2 18 18m0-11.8L6.2 18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg></button>
      </div>
      <div class="modal-body">
        <p><strong>This app supports relaxation and well‑being. It is not a medical device. Sounds are intended as gentle aides; listen mindfully and care for your hearing.</strong></p>

        <h3>What is FrequencyDoctor?</h3>
        <p>Play precise tones and seamless background soundscapes to encourage calm, focus, and sleep preparation. Browse named uses, mark favorites, and layer multiple tones with smart stereo placement.</p>

        <h3>How to use</h3>
        <ul>
          <li><b>Start playback:</b> Search/browse the list and tap an item, or enter a value and press <b>Play</b>. Volume is global.</li>
          <li><b>Background FX:</b> Pick a loop in <b>Background FX</b> and set <b>BG volume</b>. Loops are seamless and follow fades.</li>
          <li><b>Layer tones:</b> Tick multiple items, then press <b>Play Selected</b>. The app pans layers across stereo for space.</li>
          <li><b>Stop:</b> Press <b>Stop</b> to fade everything out in ~3 seconds.</li>
          <li><b>Sleep timer:</b> Choose a duration; the app pre‑fades (up to ~15s) and then stops automatically.</li>
          <li><b>Clear selections:</b> Use <b>Clear selections</b> to uncheck items and stop tones (BG may continue until stopped).</li>
        </ul>

        <h3>Fades and behavior</h3>
        <ul>
          <li><b>Fade‑in:</b> When playback starts, volume rises smoothly (~5s).</li>
          <li><b>Stop button:</b> 3s fade‑out for the whole app (tones + BG).</li>
          <li><b>Timer stop:</b> Longer, gentle fade‑out (up to ~15s) before stopping.</li>
        </ul>

        <h3>iPhone (Add to Home Screen)</h3>
        <ul>
          <li>On first tap/keypress, audio is unlocked (required by iOS).</li>
          <li>The app fetches fresh updates automatically; if it seems stale, fully close and reopen. As a last resort, remove site data and re‑add to Home Screen.</li>
        </ul>

        <h3>Safety</h3>
        <ul>
          <li>Keep volume conservative; take breaks to protect hearing.</li>
          <li>Do not use while driving or whenever full attention is required.</li>
          <li>If symptoms persist or worsen, consult a qualified clinician.</li>
        </ul>

        <h3>Selected reading</h3>
        <ul>
          <li>Bradt J, Dileo C, et al. Cochrane reviews on music interventions for anxiety and medical procedures.</li>
          <li>Chanda ML, Levitin DJ. The neurochemistry of music and its effects on mood and stress (2013).</li>
          <li>García‑Argibay S, Santed MA, Reales JM. Meta‑analysis on binaural/steady tones (2019).</li>
          <li>Hoare DJ, et al. Reviews on sound therapy approaches for tinnitus; outcomes vary by individual.</li>
        </ul>
      </div>
      <div class="modal-foot">
        <button id="helpCloseBtn" class="btn">Close</button>
      </div>
    </div>
  </div>
  <main class="container">
    <section class="controls">
      <div class="search-wrap">
        <input id="search" class="search" type="search" placeholder="Search conditions or frequencies">
        <button id="searchClear" class="search-clear" aria-label="Clear search" title="Clear search">×</button>
      </div>
      <div class="freq-input">
        <label for="freq">Frequency (Hz)</label>
        <div class="freq-row">
          <input id="freq" type="number" min="0.1" max="20000" step="0.01" value="432">
          <button id="play" class="btn primary">Play</button>
          <button id="stop" class="btn" disabled>Stop</button>
          <div class="timer-group">
            <select id="sleepTimer" class="select timer-select" aria-label="Sleep timer">
              <option value="">Timer: Off</option>
              <option value="15m">15m</option>
              <option value="30m">30m</option>
              <option value="45m">45m</option>
              <option value="1h">1h</option>
              <option value="1.5h">1,5h</option>
              <option value="2h">2h</option>
              <option value="3h">3h</option>
              <option value="4h">4h</option>
              <option value="6h">6h</option>
              <option value="8h">8h</option>
              <option value="custom">Custom…</option>
            </select>
            <div id="timerCustomWrap" class="timer-custom" hidden>
              <select id="timerHrs" class="select" aria-label="Hours"></select>
              <select id="timerMin" class="select" aria-label="Minutes"></select>
            </div>
            <span id="timerCountdown" class="timer-countdown" aria-live="polite" role="status" hidden>00:00:00</span>
          </div>
        </div>
      </div>

      <div class="multi-actions">
        <span id="selCount" class="sel-count">Selected: 0</span>
        <div class="multi-actions-right">
          <button id="clearSelected" class="btn sm">Clear selections</button>
          <button id="playSelected" class="btn sm">Play Selected</button>
          <button id="saveSelectionBtn" class="btn sm">Save selection as custom</button>
          <button id="createCustomBtn" class="btn sm primary">Create Custom Frequency</button>
        </div>
      </div>

      <div class="sliders">
        <label for="volume">Volume</label>
        <input id="volume" type="range" min="0" max="100" value="20">
      </div>
      <div class="bgfx-controls">
        <div class="bgfx-row">
          <label for="bgLoopSelect">Background FX</label>
          <select id="bgLoopSelect" class="select bgfx-select"></select>
        </div>
        <div class="bgfx-row">
          <label for="bgLoopVolume">BG volume</label>
          <input id="bgLoopVolume" type="range" min="0" max="100" value="40">
        </div>
        <div class="bgfx-row">
          <label for="freqVolume">Freq volume</label>
          <input id="freqVolume" type="range" min="0" max="100" value="100">
        </div>
      </div>
      <div class="filters">
        <div class="filter-row">
          <label for="category">Category</label>
          <select id="category" class="select">
            <option value="">All categories</option>
          </select>
        </div>
        <label class="fav-toggle"><input id="onlyFavs" type="checkbox"> Favorites only</label>
      </div>
      <div class="multi-actions">
        <div></div>
        <div class="multi-actions-right">
          <button id="tabLibrary" class="btn sm primary">Library</button>
          <button id="tabCustom" class="btn sm">Custom</button>
        </div>
      </div>
      <div id="now-playing" class="now-playing" aria-live="polite" role="status">Idle</div>
    </section>

    <section class="list" id="list"></section>
    <section class="list" id="customList" hidden></section>
  </main>
  <div id="customModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="customTitle" hidden>
    <div class="modal-overlay" data-close="1"></div>
    <div class="modal-panel">
      <div class="modal-head">
        <h2 id="customTitle">Create Custom Frequency</h2>
        <button id="customClose" class="icon-btn" aria-label="Close"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M6.2 6.2 18 18m0-11.8L6.2 18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg></button>
      </div>
      <div class="modal-body">
        <div class="setting-row"><div class="setting-label">Name</div><div class="setting-field"><input id="customName" class="search" placeholder="Name"></div></div>
        <div class="setting-row"><div class="setting-label">Description</div><div class="setting-field"><textarea id="customDesc" class="search" rows="2" placeholder="Optional"></textarea></div></div>
        <div class="setting-row"><div class="setting-label">Frequencies</div><div class="setting-field" style="flex-direction:column;align-items:stretch;gap:.35rem"><div id="customFreqs"></div><button id="addFreqBtn" class="btn sm">Add frequency</button></div></div>
        <div class="setting-row"><div class="setting-label">Background FX</div><div class="setting-field"><select id="customBg" class="select"></select></div></div>
        <div class="setting-row"><div class="setting-label">Default Freq volume</div><div class="setting-field" style="flex:1"><input id="customFreqVol" type="range" min="0" max="100" value="100" style="width:100%"></div></div>
        <div class="setting-row"><div class="setting-label">Default Sleep timer</div><div class="setting-field" style="gap:.4rem"><select id="customTimer" class="select">
          <option value="">Off</option>
          <option value="15m">15m</option>
          <option value="30m">30m</option>
          <option value="45m">45m</option>
          <option value="1h">1h</option>
          <option value="1.5h">1,5h</option>
          <option value="2h">2h</option>
          <option value="3h">3h</option>
          <option value="4h">4h</option>
          <option value="6h">6h</option>
          <option value="8h">8h</option>
          <option value="custom">Custom…</option>
        </select>
        <div id="customTimerWrap" class="timer-custom" hidden>
          <input id="customTimerHrs" class="timer-input" type="number" min="0" max="23" value="0" aria-label="Hours">
          <input id="customTimerMin" class="timer-input" type="number" min="0" max="59" value="30" aria-label="Minutes">
        </div>
        </div></div>
      </div>
      <div class="modal-foot">
        <button id="customSave" class="btn primary">Save</button>
        <button id="customCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>
  <audio id="audioOut" playsinline style="display:none"></audio>
  <script src="data/frequencies.js"></script>
  <script src="app.js"></script>
</body>
</html>
